<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini App to Google Sheets</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { 
            font-family: sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            margin: 0;
            background-color: var(--tg-theme-bg-color, #ffffff); 
            color: var(--tg-theme-text-color, #000000); 
        }
        button { 
            padding: 15px 30px; 
            font-size: 18px; 
            cursor: pointer; 
            background-color: #248b65; 
            color: white; 
            border: none; 
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button:disabled { background-color: #cccccc; }
        .info { margin-bottom: 20px; font-size: 14px; text-align: center; }
    </style>
</head>
<body>

    <div class="info">
        <p id="user-info">Yuklanmoqda...</p>
    </div>

    <button id="sendBtn">Ma'lumotni Jadvalga yozish</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand(); // Ilovani to'liq ekranga yoyish

        // SIZNING URL-MANZILINGIZ
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyH-pIiBL6DYG5wJkQ8dVpycfWqV6NkuXrQV2ILWLKz_HmEo9wULCQ-wwKO-bq2wkUR/exec";

        const user = tg.initDataUnsafe.user;
        const userInfoDisplay = document.getElementById('user-info');

        if (user) {
            userInfoDisplay.innerText = `Foydalanuvchi: ${user.first_name} (ID: ${user.id})`;
        } else {
            userInfoDisplay.innerText = "Telegram ma'lumotlari topilmadi!";
        }

        document.getElementById('sendBtn').addEventListener('click', async () => {
            const btn = document.getElementById('sendBtn');
            btn.disabled = true;
            btn.innerText = "Yuborilmoqda...";

            const payload = {
                userId: user ? user.id.toString() : "Noma'lum",
                username: user ? (user.username || user.first_name) : "Noma'lum",
                myData: "Tugma bosildi",
                initData: tg.initData
            };

            try {
                // Google Script-ga yuborish
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Google Script uchun shart
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                // no-cors rejimida javobni o'qib bo'lmaydi, shuning uchun biroz kutib xabar chiqaramiz
                alert("Ma'lumot yuborildi! Jadvalni tekshiring.");
                tg.close();

            } catch (error) {
                console.error("Xato:", error);
                alert("Xatolik yuz berdi!");
                btn.disabled = false;
                btn.innerText = "Qayta urinish";
            }
        });
    </script>
</body>
</html>
