<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<h3>Mini App</h3>
<button onclick="send()">Botga yuborish</button>

<pre id="log"></pre>

<script>
const log = (t) => {
  document.getElementById("log").textContent += t + "\n";
};

// Telegram WebApp tayyor
const tg = Telegram.WebApp;
tg.ready();

log("‚úÖ Telegram WebApp JS yuklandi");
log("üåê Version: " + tg.version);

// Init data va user
const initData = tg.initData;               // Hamma initData
const initDataUnsafe = tg.initDataUnsafe;   // User va chat haqida ma'lumotlar
const user = initDataUnsafe?.user;

// Query_id olish (agar mavjud bo‚Äòlsa)
const query_id = initDataUnsafe?.query_id || null;

// Botga yuboriladigan to‚Äòliq data
const dataToSend = {
  query_id: query_id,
  all_init_data: initData,           // Hamma initData
  user_from_webapp: user ? {
    id: user.id,
    first_name: user.first_name || "",
    last_name: user.last_name || "",
    username: user.username || ""
  } : null,
  platform: tg.platform,
  webapp_version: tg.version,
  timestamp: Date.now()
};

log("üì¶ Tayyor data:");
log(JSON.stringify(dataToSend, null, 2));

// Botga yuborish funksiyasi
function send() {
  tg.sendData(JSON.stringify(dataToSend)); // JSON shaklida yuboradi
  tg.close();                               // Mini-appni yopadi
}
</script>

</body>
</html>
