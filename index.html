<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

<h3>Mini App</h3>
<button onclick="send()">Saqlash</button>

<pre id="log"></pre>

<script>
  // Telegram WebApp tayyor
  const tg = Telegram.WebApp;
  tg.ready();

  // Log uchun
  const log = (t) => {
    document.getElementById("log").textContent += t + "\n";
  };

  log("âœ… Telegram WebApp JS yuklandi");
  log("ğŸŒ Platform: " + tg.platform);
  log("ğŸŒ Version: " + tg.version);

  // ğŸŒŸ BU YERGA yoziladi
  async function send() {
    const initData = tg.initData || "";
    const user = tg.initDataUnsafe?.user || {};

    const payload = {
      user: user,
      initData: initData,
      platform: tg.platform,
      version: tg.version,
      time: Date.now()
    };

    try {
      const res = await fetch("https://save-mini-app.adhamov20072.workers.dev/", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });

      const text = await res.text();
      alert("âœ… Ma'lumot saqlandi: " + text);
    } catch (err) {
      alert("âŒ Xato: " + err.message);
    }

    tg.close();
  }
</script>

</body>
</html>
