<!DOCTYPE html>
<html>
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding-top: 50px; background: var(--tg-theme-bg-color); color: var(--tg-theme-text-color); }
        button { padding: 15px 25px; background: #248b65; color: white; border: none; border-radius: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h2 id="user-id">Yuklanmoqda...</h2>
    <button id="mainBtn">Ma'lumotni saqlash</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        // Google Script URL (O'zingiznikini qo'ying)
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyH-pIiBL6DYG5wJkQ8dVpycfWqV6NkuXrQV2ILWLKz_HmEo9wULCQ-wwKO-bq2wkUR/exec";

        const user = tg.initDataUnsafe.user;
        if (user) {
            document.getElementById('user-id').innerText = "Salom, " + (user.first_name || user.id);
        }

        document.getElementById('mainBtn').addEventListener('click', async () => {
            const dataToSend = {
                userId: user ? user.id : "Noma'lum",
                username: user ? user.username : "Noma'lum",
                myData: "Foydalanuvchi tugmani bosdi", // Bu yerga ixtiyoriy ma'lumot
                initData: tg.initData
            };

            // Tugmani o'chirib turish (ikki marta bosmaslik uchun)
            document.getElementById('mainBtn').innerText = "Yuborilmoqda...";
            document.getElementById('mainBtn').disabled = true;

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Google Script uchun muhim
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dataToSend)
                });

                // 'no-cors' rejimida biz aniq javobni o'qiya olmaymiz, 
                // lekin so'rov ketgan bo'ladi.
                alert("Ma'lumot yuborildi!");
                tg.close();
            } catch (error) {
                alert("Xatolik: " + error);
                document.getElementById('mainBtn').disabled = false;
                document.getElementById('mainBtn').innerText = "Qayta urinish";
            }
        });
    </script>
</body>
</html>
